{% extends 'base.html.twig' %}
{% block head %}<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>{% endblock %}
{% block title %}Sortir | Accueil{% endblock %}


{% block body %}


    <h1>Creer une sortie</h1>


    <div id="sortie_form">
        {{ form_start(sortieForm) }}

        {{ form_row(sortieForm.nom) }}
        {{ form_row(sortieForm.dateHeureDebut) }}
        {{ form_row(sortieForm.duree) }}
        {{ form_row(sortieForm.dateLimiteInscription) }}
        {{ form_row(sortieForm.nbInscriptionsMax) }}
        {{ form_row(sortieForm.infosSortie) }}
        {{ form_row(sortieForm.ville) }}


        {{ form_row(sortieForm.lieu) }}

      <script>

                $(document).ready(function(){
                $("#sortie_lieu").on('change', function run() {
                    var selectElmt = document.getElementById("sortie_lieu");
                    var id = selectElmt.options[selectElmt.selectedIndex].value;

                    console.log(id);
                    $.ajax({
                        url : "{{ path('getLieu') }}",
                        type : 'POST',
                        data: {id: id}
                    }).done(function(data) {
                        document.getElementById('nomLieu').innerHTML = data;

                    }).fail(function() {
                        console.log('Failed');
                    });

                })
                });


        </script>


        <script>

            $(document).ready(function(){
                $("#sortie_ville").on('change', function run() {
                    var selectElmt = document.getElementById("sortie_ville");
                    var idVille = selectElmt.options[selectElmt.selectedIndex].value;
                    console.log(idVille);
                    $.ajax({
                        url : "{{ path('getVille') }}",
                        type : 'POST',
                        data: {idVille: idVille}
                    }).done(function(data) {

                        $('#sortie_lieu').empty();

                    for (var i = 0; i<data.length; i++){
                        $('#sortie_lieu').append("<option value=\""+data[i]["id"]+"\">"+data[i]["nom"]+"</option>");
                        }
                        $("#sortie_lieu").change();
                    }).fail(function() {
                        console.log('Failed');
                    });

                })
            });


        </script>




        <button type="submit">Valider</button>


        {{ form_end(sortieForm) }}
    </div>


    <ul>
        <span id="nomLieu"> </span>
    </ul>


    <a href="{{path('sortie_creerLieu') }}" title="Sortir | Créer un lieu">créer un lieu</a>
{% endblock %}